# Руководство по развертыванию приложения на хостинге

## Проблема
При попытке входа в систему на хостинге возникает ошибка 500 (Internal Server Error). Это связано с тем, что приложение не может подключиться к базе данных или неправильно настроены переменные окружения.

## Диагностика проблемы

### 1. Проверка подключения к базе данных
Убедитесь, что параметры подключения к базе данных установлены правильно:

В файле `.env` или в переменных окружения хостинга должны быть установлены следующие параметры:
```
DB_HOST=хост_базы_данных
DB_PORT=порт_базы_данных
DB_NAME=имя_базы_данных
DB_USER=пользователь_базы_данных
DB_PASSWORD=пароль_пользователя_базы_данных
```

### 2. Проверка URL API
Убедитесь, что переменная окружения `REACT_APP_API_URL` указывает на правильный URL вашего API:
```
REACT_APP_API_URL=http://ваш_хост:порт
```

Например:
```
REACT_APP_API_URL=http://45.150.9.70:8001
```

## Решение проблемы

### Шаг 1: Настройка переменных окружения на хостинге

1. Создайте или обновите файл `.env` на вашем хостинге с правильными параметрами базы данных:
```
# Production environment variables
ENVIRONMENT=production
ADMIN_PASSWORD=ваш_пароль_администратора
ENCRYPTION_KEY=ваш_ключ_шифрования

# Database configuration
DB_HOST=хост_базы_данных
DB_PORT=3306
DB_NAME=имя_базы_данных
DB_USER=пользователь_базы_данных
DB_PASSWORD=пароль_пользователя_базы_данных

# Environment variables for the frontend
REACT_APP_API_URL=http://ваш_хост:порт
NODE_ENV=production
```

### Шаг 2: Проверка доступности портов

Убедитесь, что порт 8001 (или другой порт, который вы используете для API) открыт на вашем хостинге и доступен извне.

В файле `main.py` сервер запускается так:
```python
uvicorn.run(
    "main:app",
    host="0.0.0.0",  # Слушает на всех интерфейсах
    port=8001,
    log_level="info"
)
```

### Шаг 3: Создание таблиц в базе данных

При первом запуске приложение автоматически создаст необходимые таблицы в базе данных. Убедитесь, что у пользователя базы данных есть права на создание таблиц.

### Шаг 4: Перезапуск приложения

После изменения переменных окружения перезапустите приложение.

## Дополнительная диагностика

### Проверка подключения к базе данных
Вы можете использовать скрипт `check_db.py` для проверки подключения к базе данных:
```bash
python check_db.py
```

### Проверка работоспособности API
Вы можете проверить работоспособность API с помощью curl:
```bash
curl http://ваш_хост:порт/api/health/
```

### Проверка аутентификации
Вы можете проверить аутентификацию с помощью следующего скрипта:
```python
import requests
import json

url = "http://ваш_хост:порт/api/login/"
payload = {
    "username": "имя_пользователя",
    "password": "пароль"
}
headers = {
    "Content-Type": "application/json"
}

response = requests.post(url, data=json.dumps(payload), headers=headers)
print(f"Status Code: {response.status_code}")
print(f"Response: {response.text}")
```

## Часто встречающиеся проблемы

### 1. Ошибка подключения к базе данных
- Проверьте правильность параметров подключения
- Убедитесь, что база данных доступна с сервера приложения
- Проверьте, что у пользователя есть необходимые права

### 2. Ошибка CORS
Если возникают ошибки CORS, убедитесь, что в файле `main.py` в списке `allowed_origins` добавлен ваш домен:
```python
allowed_origins = [
    "http://localhost:3001", 
    "http://127.0.0.1:3001", 
    "http://localhost:3000", 
    "http://127.0.0.1:3000", 
    "http://ваш_домен"
]
```

### 3. Ошибка 500 Internal Server Error
- Проверьте логи сервера для получения подробной информации об ошибке
- Убедитесь, что все зависимости установлены правильно
- Проверьте, что все необходимые переменные окружения установлены

## Поддержка
Если у вас возникли проблемы с развертыванием, обратитесь к документации или свяжитесь с поддержкой хостинга.