# Безопасность токенов ботов Telegram

## Обзор

Этот документ описывает меры безопасности, реализованные в системе для защиты токенов ботов Telegram.

## Хранение токенов

### В продакшене
- Токены хранятся **только** в переменных окружения
- API эндпоинты для сохранения/удаления токенов **отключены**
- Файлы с токенами **не используются**

### В разработке
- Токены могут храниться в файле `bot_tokens.json`
- Токены в файле **шифруются** с использованием симметричного шифрования
- API эндпоинты для сохранения/удаления токенов **доступны**

## Иерархия получения токенов

При получении токена для бота система проверяет источники в следующем порядке:

1. **Переменная окружения для конкретного бота**: `BOT_TOKEN_{BOT_ID}` (в верхнем регистре)
2. **Общая переменная окружения**: `BOT_TOKEN`
3. **Файл токенов**: `bot_tokens.json` (только в разработке, с шифрованием)

## Переменные окружения

### Обязательные
- `ENVIRONMENT` - должно быть установлено в `production` для продакшена

### Опциональные
- `BOT_TOKEN` - общий токен для всех ботов
- `BOT_TOKEN_{BOT_ID}` - токен для конкретного бота (BOT_ID в верхнем регистре)
- `ENCRYPTION_KEY` - ключ для шифрования токенов (генерируется автоматически в разработке)
- `ADMIN_PASSWORD` - пароль администратора для защищенных операций

## Защищенные эндпоинты

### Отключены в продакшене
- `/api/save_token/{bot_id}/` - сохранение токенов через API
- `/api/delete_token/{bot_id}/` - удаление токенов через API

### Требуют аутентификации
- `/api/save_token/{bot_id}/` - сохранение токенов (требует аутентификации администратора)
- `/api/delete_token/{bot_id}/` - удаление токенов (требует аутентификации администратора)

## Рекомендации по безопасности

### Для продакшена
1. Установите переменную окружения `ENVIRONMENT=production`
2. Храните токены только в переменных окружения
3. Установите уникальный `ENCRYPTION_KEY` для шифрования
4. Установите `ADMIN_PASSWORD` для защиты административных функций
5. Не храните файл `bot_tokens.json` в репозитории (добавлен в .gitignore)
6. Используйте уникальные переменные окружения для каждого бота:
   ```
   BOT_TOKEN_MAINBOT=your_main_bot_token
   BOT_TOKEN_TESTBOT=your_test_bot_token
   ```

### Для разработки
1. Используйте файл `.env` для хранения токенов во время разработки
2. Файл `.env` должен быть добавлен в .gitignore
3. Создайте файл `.env.example` с примерами переменных

## Примеры конфигурации

### .env (для разработки)
```env
ENVIRONMENT=development
BOT_TOKEN_MAINBOT=123456789:ABCDEF1234567890ABCDEF1234567890ABC
BOT_TOKEN_TESTBOT=987654321:FEDCBA0987654321FEDCBA0987654321FED
ENCRYPTION_KEY=your_encryption_key_here
ADMIN_PASSWORD=your_admin_password_here
```

### .env (для продакшена)
```env
ENVIRONMENT=production
BOT_TOKEN_MAINBOT=123456789:ABCDEF1234567890ABCDEF1234567890ABC
BOT_TOKEN_TESTBOT=987654321:FEDCBA0987654321FEDCBA0987654321FED
ENCRYPTION_KEY=your_secure_encryption_key_here
ADMIN_PASSWORD=your_secure_admin_password_here
```