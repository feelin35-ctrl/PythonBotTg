# Система аутентификации и управления ботами

## Обзор

Эта система позволяет пользователям регистрироваться, входить в систему и управлять своими ботами. Каждый пользователь видит только те боты, которые он создал.

## Структура базы данных

Система использует MySQL базу данных с тремя основными таблицами:

1. `users` - хранит информацию о пользователях
2. `user_tokens` - хранит зашифрованные токены пользователей
3. `bot_owners` - отслеживает владение ботами

## Установка и настройка

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Настройка базы данных

Создайте файл `.env` в корне проекта со следующим содержимым:

```
DB_HOST=localhost
DB_NAME=telegram_bot_builder
DB_USER=your_username
DB_PASSWORD=your_password
DB_PORT=3306
```

### 3. Инициализация базы данных

Запустите скрипт инициализации базы данных:

```bash
python init_db.py
```

### 4. Инициализация системы владения ботами

Если у вас уже есть существующие боты, запустите скрипт инициализации системы владения:

```bash
python init_bot_ownership.py
```

Этот скрипт автоматически назначит владельцев для всех существующих ботов без владельцев, используя первого пользователя в системе (обычно это администратор) как владельца по умолчанию.

## Использование

### Регистрация

1. Перейдите на страницу регистрации
2. Введите имя пользователя, email и пароль
3. После успешной регистрации вы будете автоматически залогинены

### Вход в систему

1. Перейдите на страницу входа
2. Введите имя пользователя и пароль
3. После успешного входа вы будете перенаправлены на страницу со списком ботов

### Управление ботами

- Каждый пользователь видит только те боты, которые он создал
- При создании нового бота, система автоматически регистрирует текущего пользователя как владельца
- При импорте бота также регистрируется владелец

## Безопасность

- Все пароли хешируются с использованием SHA-256
- Токены пользователей хранятся в зашифрованном виде
- Каждый пользователь имеет доступ только к своим ботам

## Устранение неполадок

### Проблемы с подключением к базе данных

1. Проверьте настройки в файле `.env`
2. Убедитесь, что MySQL сервер запущен
3. Проверьте, что указанные учетные данные верны

### Проблемы с отображением ботов

Если пользователи видят не все свои боты или видят чужие боты:

1. Убедитесь, что все боты имеют зарегистрированных владельцев:
   ```bash
   python init_bot_ownership.py
   ```

2. Проверьте таблицу владения ботами:
   ```bash
   python check_db.py
   ```

### Проблемы с созданием ботов

Если при создании ботов не регистрируется владелец:

1. Убедитесь, что вы вошли в систему
2. Проверьте, что frontend правильно передает user_id при создании ботов
3. Проверьте логи сервера на наличие ошибок