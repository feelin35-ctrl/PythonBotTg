# Система ролей пользователей

## Обзор

Эта документация описывает новую систему ролей пользователей в конструкторе Telegram ботов. Система ролей позволяет управлять доступом пользователей к различным функциям системы.

## Роли пользователей

### 1. super_admin (Суперадминистратор)
- Может видеть всех пользователей в системе
- Может видеть все боты в системе
- Может назначать других пользователей суперадминистраторами
- Может создавать ботов
- Имеет отдельный личный кабинет

### 2. admin (Администратор)
- Может создавать ботов
- Может видеть только свои собственные боты
- Это роль по умолчанию для новых пользователей

## Реализация

### База данных

В таблице `users` добавлено новое поле `role` типа ENUM с возможными значениями:
- `super_admin`
- `admin` (значение по умолчанию)

```sql
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role ENUM('super_admin', 'admin') DEFAULT 'admin',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP NULL
)
```

### API Endpoints

#### Получение списка ботов
`GET /api/get_bots/`

- Для super_admin: возвращает все боты в системе
- Для admin: возвращает только боты, принадлежащие пользователю

#### Получение списка всех пользователей
`GET /api/get_all_users/`

- Только для super_admin
- Возвращает список всех пользователей в системе

#### Обновление роли пользователя
`POST /api/update_user_role/`

- Только для super_admin
- Позволяет назначать других пользователей суперадминистраторами

### Скрипты управления

#### Создание суперадминистратора
```bash
python create_admin_user.py
```

#### Регистрация обычного пользователя
```bash
python register_user.py
```

#### Просмотр всех пользователей
```bash
python register_user.py list
```

## Безопасность

1. Только super_admin может назначать других super_admin
2. Все API endpoints проверяют роль пользователя перед выполнением операций
3. Пароли хешируются с использованием SHA-256

## Расширяемость

Система ролей разработана с учетом возможности добавления новых ролей в будущем:
- Поле `role` в базе данных может быть легко расширено
- Проверки ролей в коде написаны гибко
- API endpoints легко адаптируются для новых ролей

## Тестирование

Для проверки функциональности системы ролей созданы тестовые скрипты:
- [test_roles.py](file:///d:/PythonBotTg/test_roles.py) - комплексное тестирование системы ролей
- [test_admin_api.py](file:///d:/PythonBotTg/test_admin_api.py) - тестирование API endpoints
- [test_super_admin.py](file:///d:/PythonBotTg/test_super_admin.py) - тестирование функциональности super_admin

## Примеры использования

### Регистрация нового пользователя
Новые пользователи автоматически получают роль `admin` и могут создавать ботов, видя только свои собственные.

### Назначение суперадминистратора
Существующий super_admin может назначить другого пользователя super_admin через API endpoint или с помощью скрипта [promote_user_to_admin.py](file:///d:/PythonBotTg/promote_user_to_admin.py).

### Просмотр всех пользователей
Только super_admin может получить список всех пользователей в системе через endpoint `/api/get_all_users/`.